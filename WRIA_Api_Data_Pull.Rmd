---
title: "WRIA_Api_Data_Pull"
output: html_document
---


```{r setup, echo=FALSE, message=FALSE, warning=FALSE, error=FALSE, include=FALSE}
startTime <- Sys.time()

libs <- readLines("Data/Libraries.txt")
sapply(libs, require, character.only=TRUE)

source("WRIA_Api_Data_Source.R")

userInput <- readReportRequest()

#userInput$Approved <- TRUE
#userInput$Refuge <- "ST. MARKS"

dataName <- gsub(" ", "", str_to_title(userInput$Refuge))

#limit lookup goes here
#param lookup goes here


#Obtain huc and refuge data, then get related NWIS and WQP sites and data, store in siteData object

#if approved hucs should be obtained via approved boundaries



siteData <- getSiteData(userInput)
endTime <- Sys.time()
time <- endTime-startTime

interest <- siteData$interestData
approved <- siteData$approvedData
huc8 <- siteData$huc8Data
huc10 <- siteData$huc10Data

if(userInput$Approved){
  orgname <- unique(approved@baseData$ORGNAME)
}else{
  orgname <- unique(interest@baseData$ORGNAME)
}


```

## R Markdown

This report presents data downloaded on `r Sys.Date()` from the USGS and EPA hydrologic and water quality database accessed via the R dataRetrieval package (de Cicco et al. 2018).  The report runs based on user input supplied in the file: *ReportRequest.xlsx*.  Resulting data are saved into a project folder and presented for inspection in this interactive html report.  



## Refuge Boundaries and Associated Hydrologic Units

## `r unique(orgname)`
##`r hey`
##The refuge intersects `r nrow(huc8@baseData)` HUC8 (`r unique(huc8$NAME)`) and `r nrow(huc10)` HUC10 (`r unique(huc10$NAME)`) units.  

```{r, echo=FALSE, message=FALSE, warning=FALSE, error=FALSE}

hucPlot <- generatePlot(siteData)
hucPlot

#write.csv(huc8AvailWqpData,sprintf("%s/%s_huc8AvailableWqpData.csv",userInput$ResultFolder, dataName))
#write.csv(huc10AvailWqpData,sprintf("%s/%s_huc10AvailableWqpData.csv",userInput$ResultFolder, dataName))

#write.csv(huc8AvailNwisData,sprintf("%s/%s_huc8AvailableNwisData.csv",userInput$ResultFolder, dataName))
#write.csv(huc10AvailNwisData,sprintf("%s/%s_huc10AvailableNwisData.csv",userInput$ResultFolder, dataName))


```









